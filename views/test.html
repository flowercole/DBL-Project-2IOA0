<!--
HTML FOR VISUALIZATION TOOL
code by Maxim Snoep (1313517)
 -->
<html>

<head>
  <meta charset="UTF-8">
	<title>Funsualization</title>
	<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet">
	<link href="public/test.css" rel="stylesheet">
</head>


<body>
	<div class='container'>

    <!-- Logo in Corner -->
    <div class='logo component bordered'>
      <img src='public/logo.png'></img>
    </div>

    <!-- Top Header, with upload and select datasets fuctions -->
    <div class='header component'>
      <!-- Upload Datasets -->
      <div class='upload component bordered'>
        <!-- Left Upload Component -->
        <div class='upload-left'>
          <input id="input" type="file" class='input'><label for="input" id='input-placeholder' class='input-placeholder button bordered'>Choose a file</label>
          <input id="filename" placeholder="Filename (Optional)" type="text" class='file-name button bordered' autocomplete="off" spellcheck="false">
          <button type='button' id="submit" class='file-upload button bordered'>Upload!</button>
        </div>
        <!-- Right Upload Component -->
        <div class='upload-right'>
          <p class='file-info'>
          File: <span id='file'>No file uploaded.</span><br>
          Error:  <span id='msg'>No errors.</span><br>
          File Name: <span id='name'>No file uploaded.</span>
          </p>
        </div>
      </div>
      <!-- Select Datasets-->
      <div class='select component bordered'>
        <!-- Data Selector Component -->
        <select id="select-data">
        </select>
      </div>
    </div>

    <!-- About Component-->
    <div class='about component bordered'>
      <button id='about-btn' class='button bordered'>about</button>
      <button id='contact-btn' class='button bordered'>contact</button>
      <button id='help-btn' class='button bordered'>help</button>
    </div>

    <!-- Left Settings Component -->
    <div class='left component'>
      <div class='component'>
        <p>Graph settings:</p>
        <div class='component bordered'>
            <p>Link width</p>
            <input id="linkWidth" type="range" min="0" max="250" value="10">

            <p>Link opacity</p>
            <input id="linkOpacity" type="range" min="1" max="100" value="100">

            <p>Node size</p>
            <input id="nodeSize" type="range" min="5" max="100" value="25">

            <p>Node color</p>
            <input id="nodeColor" type="color" value="#0080ff">

            <p>Selected node color</p>
            <input id="selNodeColor" type="color" value="#ff88aa">

            <button type='button' id='renderSelected' class='button bordered'>Show Selected</button>
            <button type='button' id='renderReset' class='button bordered'>Reset</button>
            <button type='button' id='updateView' class='button bordered'>Update</button>

            <p>Min edge weight</p>
            <input id="minWeight" type="range" min="0" max="100" value="0">

            <p>Max edge weight</p>
            <input id="maxWeight" type="range" min="0" max="100" value="100">

            <button type='button' id='filterEdges' class='button bordered'>Apply Filters</button>
          </div>
        </div>

        <div class='component'>
          <p>Heatmap settings:</p>
          <div class='component bordered'>
            <p>Heatmap start color</p>
            <input id="startColor" type="color" value="#D3DFFF">

            <p>Heatmap end color</p>
            <input id="endColor" type="color" value="#003DDE">

            <button type='button' id='updateHeatmap' class='button bordered'>Update Heatmap</button>

            <p>Select reordering</p>
            <select id="selectReordering", onchange="SelectReordering(this);">
              <option value="original">Original</option>
              <option value="alphabetical">Alphabetical</option>
              <option value="sum">Sum</option>
              <option value="average">Average</option>
            </select>
          </div>
        </div>

    </div>

    <div class='main component' id='canvas'>
    </div>

    <div class='right component'>
      <!-- Layout Selector -->
      <div class='component'>
        <p>Layout settings:</p>
        <div class='component bordered'>
          <p>Number of visualizations</p>
          <select id="select-layout">
            <option value="1">One visualization</option>
            <option value="2">Two visualizations</option>
            <option value="3">Three visualizations</option>
            <option value="4">Four visualizations</option>
          </select>

          <!-- Visualization Selector 1 -->
          <p>Select 1st visualization</p>
          <select id="select-vis-1">
            <option value="force">Force Directed Graph</option>
            <option value="radial">Radial Graph</option>
            <option value="radial">Third Graph</option>
            <option value="matrix">Matrix Heatmap</option>
          </select>

          <!-- Visualization Selector 2 -->
          <p>Select 2nd visualization</p>
          <select id="select-vis-2">
            <option value="force">Force Directed Graph</option>
            <option value="radial">Radial Graph</option>
            <option value="radial">Third Graph</option>
            <option value="matrix">Matrix Heatmap</option>
          </select>

          <!-- Visualization Selector 3 -->
          <p>Select 3rd visualization</p>
          <select id="select-vis-3">
            <option value="force">Force Directed Graph</option>
            <option value="radial">Radial Graph</option>
            <option value="radial">Third Graph</option>
            <option value="matrix">Matrix Heatmap</option>
          </select>

          <!-- Visualization Selector 4 -->
          <p>Select 4th visualization</p>
          <select id="select-vis-4">
            <option value="force">Force Directed Graph</option>
            <option value="radial">Radial Graph</option>
            <option value="radial">Third Graph</option>
            <option value="matrix">Matrix Heatmap</option>
          </select>

          <button type='button' id="updateLayout" class='button bordered'>Update Layout</button>
        </div>
      </div>
    </div>

	</div>

  <!-- Include Upload scripts -->
  <script src='public/scripts/upload/upload.js'></script>
  <script src='public/scripts/upload/dragdrop.js'></script>
  <script src='public/scripts/upload/select.js'></script>

  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="/public/scripts/matrix/matrix.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="/public/scripts/graph/graph.js"></script>
  <script src="/public/scripts/graph/graphs/forceGraph.js"></script>
  <script src="/public/scripts/graph/graphs/radialGraph.js"></script>

  <script>

  loadComponent = (component) => {
    fetch(`/comp/${component}.html`)
    .then(function(response) {
      response.text().then(function (body) {
        document.getElementById(`component-${component}`).innerHTML = body;
      });
      return response;
    });
  };


  // Layout Selector
  let selectLayout = document.querySelector('#select-layout');

  // Get Layout from Selector
  getLayout = () => {
    selected_layout = selectLayout.value;
    localStorage.setItem('layout', selected_layout);
    console.log(`You've selected layout: ${selected_layout} !`)
  }

  // Layout Selector Listener
  selectLayout.addEventListener('click', function(){ getLayout() }, false);

  let aboutBtn = document.getElementById('about-btn');
  aboutBtn.addEventListener('click', function(){
    showLayout('1');
    loadCanvas('about', 'box1')}
  )

  let contactBtn = document.getElementById('contact-btn');
  contactBtn.addEventListener('click', function(){
    showLayout('1');
    loadCanvas('contact', 'box1')}
  )

  let helpBtn = document.getElementById('help-btn');
  helpBtn.addEventListener('click', function(){
    showLayout('1');
    loadCanvas('help', 'box1')}
  )


  // Visualization Selector
  let selectVis1 = document.querySelector('#select-vis-1');
  let selectVis2 = document.querySelector('#select-vis-2');
  let selectVis3 = document.querySelector('#select-vis-3');
  let selectVis4 = document.querySelector('#select-vis-4');

  // Get Visualization from Selector
  getVisualization = (num) => {
        switch (num) {
          case 1:
            selected_visualization = selectVis1.value;
            break;
          case 2:
            selected_visualization = selectVis2.value;
            break;
          case 3:
            selected_visualization = selectVis3.value;
            break;
          case 4:
            selected_visualization = selectVis4.value;
            break;
        }
        localStorage.setItem(`vis-${num}`, selected_visualization);
        console.log(`You've set Visualization ${num} to ${selected_visualization} !`)
  }

  // Visualization Selector Listener
  selectVis1.addEventListener('click', function(){ getVisualization(1) }, false);
  selectVis2.addEventListener('click', function(){ getVisualization(2) }, false);
  selectVis3.addEventListener('click', function(){ getVisualization(3) }, false);
  selectVis4.addEventListener('click', function(){ getVisualization(4) }, false);


  setSelectors = (value, selector) => {
    var val = localStorage.getItem(value);
    var sel = selector;
    console.log(val, sel)
    var opts = sel.options;
    for (var opt, j = 0; opt = opts[j]; j++) {
      if (opt.value == val) {
        sel.selectedIndex = j;
        break;
      }
    }
  }

  setSelectors('layout', selectLayout);
  setSelectors('vis-1', selectVis1);
  setSelectors('vis-2', selectVis2);
  setSelectors('vis-3', selectVis3);
  setSelectors('vis-4', selectVis4);

  // Update Layout Button Selector
  let updateLayout_btn = document.getElementById('updateLayout')

  // Update Layout Function
  submitLayout = (num) => {
      showLayout(num);
      showCanvas(num);
      showVisualizations(num);
  }

  // Update Layout Button Listener
  updateLayout_btn.addEventListener('click', function(){ submitLayout(localStorage.getItem('layout')) }, false);



  // Canvas
  let canvas = document.getElementById('canvas');

  // Show Layout Function
  showLayout = (num) => {
    canvas.innerHTML = '';
    box = document.createElement('div');
    box.classList.add('component')
    box.classList.add('bordered')

    if (parseInt(num) > 0 ) {
      box1 = box.cloneNode(true)
      box1.id = 'box1';
      canvas.appendChild(box1);
    }
    if (parseInt(num) > 1 ) {
      box2 = box.cloneNode(true)
      box2.id = 'box2';
      canvas.appendChild(box2);
    }
    if (parseInt(num) > 2 ) {
      box3 = box.cloneNode(true)
      box3.id = 'box3';
      canvas.appendChild(box3);
    }
    if (parseInt(num) > 3 ) {
      box4 = box.cloneNode(true)
      box4.id = 'box4';
      canvas.appendChild(box4);
    }

    switch (num) {
      case '1':
        box1.style = 'grid-area: a / a / d / d; ';
        break;
      case '2':
        box1.style = 'grid-area: a / a / a / d';
        box2.style = 'grid-area: c / c / c / d';
        break;
      case '3':
        box1.style = 'grid-area: a / a / a / d';
        box2.style = 'grid-area: c';
        box3.style = 'grid-area: d';
        break;
      case '4':
        box1.style = 'grid-area: a';
        box2.style = 'grid-area: b';
        box3.style = 'grid-area: c';
        box4.style = 'grid-area: d';
        break;
    }
  }

  // Show Canvas Function
  showCanvas = (num) => {
    if (parseInt(num) > 0 ) {
      loadCanvas(localStorage.getItem('vis-1'), 'box1');
    }
    if (parseInt(num) > 1 ) {
      loadCanvas(localStorage.getItem('vis-2'), 'box2');
    }
    if (parseInt(num) > 2 ) {
      loadCanvas(localStorage.getItem('vis-3'), 'box3');
    }
    if (parseInt(num) > 3 ) {
      loadCanvas(localStorage.getItem('vis-4'), 'box4');
    }
  }

  // Load Canvas Function
  loadCanvas = (visualization, box) => {
    fetch(`/comp/${visualization}.html`)
    .then(function(response) {
      response.text().then(function (body) {
        document.getElementById(box).innerHTML = body;
      });
      return response;
    });
  }


  // Show Visualization Function
  showVisualizations = (num) => {
    if (parseInt(num) > 0 ) {
      setTimeout(function(){ loadVisualization(localStorage.getItem('vis-1'), 'box1', localStorage.getItem('layout')); }, 1000);
    }
    if (parseInt(num) > 1 ) {
      setTimeout(function(){ loadVisualization(localStorage.getItem('vis-2'), 'box2', localStorage.getItem('layout')); }, 6000);
    }
    if (parseInt(num) > 2 ) {
      setTimeout(function(){ loadVisualization(localStorage.getItem('vis-3'), 'box3', localStorage.getItem('layout')); }, 11000);
    }
    if (parseInt(num) > 3 ) {
      setTimeout(function(){ loadVisualization(localStorage.getItem('vis-4'), 'box4', localStorage.getItem('layout')); }, 16000);
    }
  }

  // Load Visualization Function
  loadVisualization = (vis, box, layout) => {
    switch(vis) {
      case 'matrix':
        loadMatrix(box);
        break;
      case 'force':
        loadGraph(box, vis);
        break;
      case 'radial':
        loadGraph(box, vis);
        break;
      case 'third':
        loadGraph(box, vis);
        break;
    }
  }

  </script>


</body>
</html>
